<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading... | DevLog</title>
    <meta name="description" content="">
    
    <!-- Preconnect for fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Open Graph (will be updated by seo.js immediately) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Loading..." id="og-title">
    <meta property="og:description" content="Loading post..." id="og-description">
    <meta property="og:image" content="https://triccs.github.io/blog/images/og-default.svg" id="og-image">
    <meta property="og:url" content="" id="og-url">
    
    <!-- Twitter Card (will be updated by seo.js) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="" id="twitter-title">
    <meta name="twitter:description" content="" id="twitter-description">
    <meta name="twitter:image" content="" id="twitter-image">
    
    <!-- Canonical -->
    <link rel="canonical" href="" id="canonical">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- JSON-LD will be injected by seo.js -->
    <script type="application/ld+json" id="article-schema">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "",
        "image": "",
        "datePublished": "",
        "author": {
            "@type": "Person",
            "name": "Your Name"
        }
    }
    </script>
</head>
<body>
    <div class="gradient-bg"></div>
    
    <header class="site-header">
        <nav class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-bracket">{</span>
                <span class="logo-text">DevLog</span>
                <span class="logo-bracket">}</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">Posts</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
            </ul>
        </nav>
    </header>

    <main class="main-content">
        <article class="post-article" id="postArticle">
            <header class="post-header">
                <a href="index.html" class="back-link">&larr; Back to posts</a>
                <div class="post-meta" id="postMeta">
                    <!-- Date, reading time, tags injected here -->
                </div>
                <h1 class="post-title" id="postTitle">Loading...</h1>
            </header>
            
            <figure class="post-cover" id="postCover">
                <!-- Cover image injected here -->
            </figure>
            
            <div class="post-content" id="postContent">
                <!-- Post content injected here -->
            </div>
            
            <footer class="post-footer">
                <div class="share-section">
                    <span class="share-label">Share this post:</span>
                    <div class="share-buttons" id="shareButtons">
                        <!-- Share buttons injected here -->
                    </div>
                </div>
            </footer>
        </article>
    </main>

    <footer class="site-footer">
        <p>&copy; 2026 DevLog. Built with vanilla HTML, CSS & JS.</p>
    </footer>

    <!-- Load scripts immediately (not deferred) so meta tags are set before iMessage crawler reads the page -->
    <script>
        // Inline script to set meta tags ASAP - runs synchronously in head
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');
            if (postId) {
                // Determine base path for GitHub Pages
                const hostname = window.location.hostname;
                const pathname = window.location.pathname;
                const isGitHubPages = hostname.includes('github.io');
                const basePath = isGitHubPages ? '/blog' : '';
                const baseUrl = window.location.origin + basePath;
                
                // Fetch posts immediately and update meta tags
                const postsUrl = basePath + '/posts/posts.json';
                fetch(postsUrl)
                    .then(r => r.json())
                    .then(data => {
                        const post = data.posts.find(p => p.id === postId);
                        if (post) {
                            // Resolve image path
                            const imagePath = post.coverImage.startsWith('http') 
                                ? post.coverImage 
                                : baseUrl + (post.coverImage.startsWith('/') ? post.coverImage : '/' + post.coverImage);
                            
                            const postUrl = baseUrl + '/post.html?id=' + postId;
                            
                            // Update meta tags immediately - iMessage crawler reads these
                            const ogTitle = document.querySelector('meta[property="og:title"]');
                            const ogDesc = document.querySelector('meta[property="og:description"]');
                            const ogImage = document.querySelector('meta[property="og:image"]');
                            const ogUrl = document.querySelector('meta[property="og:url"]');
                            const twTitle = document.querySelector('meta[name="twitter:title"]');
                            const twDesc = document.querySelector('meta[name="twitter:description"]');
                            const twImage = document.querySelector('meta[name="twitter:image"]');
                            
                            if (ogTitle) ogTitle.content = post.title;
                            if (ogDesc) ogDesc.content = post.excerpt;
                            if (ogImage) ogImage.content = imagePath;
                            if (ogUrl) ogUrl.content = postUrl;
                            if (twTitle) twTitle.content = post.title;
                            if (twDesc) twDesc.content = post.excerpt;
                            if (twImage) twImage.content = imagePath;
                            
                            document.title = post.title + ' | DevLog';
                            const descMeta = document.querySelector('meta[name="description"]');
                            if (descMeta) descMeta.content = post.excerpt;
                        }
                    })
                    .catch(e => console.error('Failed to load post for meta tags:', e));
            }
        })();
    </script>
    <script src="js/seo.js"></script>
    <script src="js/posts.js"></script>
</body>
</html>

